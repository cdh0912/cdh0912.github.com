<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script src="http://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
<script type="text/javascript" src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0-rc1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?region=KR"></script>
<script src="assets/js/RegisterMapFunction.js"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
<link href="assets/styles/plannerstyle.css" rel="stylesheet" type="text/css">

<script type="text/javascript">
var realRoot = "${root}";
siteList = [{'saved_picture':'11460125234086.jpg','savefolder':'2015/0705','type':0,'site_id':101,'site_name':'경주 불국사','latitude':35.7900971,'longitude':129.33209239999996,'address':'한국 경상북도 경주시 진현동 15-1 불국사','approval':1,'loc_id':0},{'saved_picture':'1529317833909.jpg','savefolder':'2015/0629','type':0,'site_id':121,'site_name':'강릉 단오축제','latitude':37.7483819,'longitude':128.89613899999995,'address':'한국 강원도 강릉시 노암동 단오공원','approval':1,'loc_id':0},{'saved_picture':'16738456379351.jpg','savefolder':'2015/0619','type':0,'site_id':6,'site_name':'강남역','latitude':37.49794199999999,'longitude':127.02762099999995,'address':'한국 서울특별시 강남구 역삼동 821-1 강남역','approval':1,'loc_id':0},{'saved_picture':'16847669909356.jpg','savefolder':'2015/0619','type':0,'site_id':7,'site_name':'한국정보기술연구원','latitude':37.4851155,'longitude':126.89879829999995,'address':'한국 서울특별시 구로구 디지털로34길 43','approval':1,'loc_id':0},{'saved_picture':'17241935857094.jpg','savefolder':'2015/0619','type':0,'site_id':8,'site_name':'광안리 해수욕장','latitude':35.1531696,'longitude':129.11866599999996,'address':'부산광역시 광안동 광안리해수욕장','approval':1,'loc_id':0},{'saved_picture':'17342046230993.jpg','savefolder':'2015/0619','type':0,'site_id':9,'site_name':'해운대 해수욕장','latitude':35.1586975,'longitude':129.16038419999995,'address':'부산광역시 중동 해운대해수욕장','approval':1,'loc_id':0},{'saved_picture':'17602373444441.jpg','savefolder':'2015/0619','type':0,'site_id':10,'site_name':' 엑스포과학공원','latitude':36.3769807,'longitude':127.38459749999993,'address':'한국 대전광역시 유성구 도룡동 대덕대로 480 엑스포과학공원','approval':1,'loc_id':0},{'saved_picture':'25409565175240.jpg','savefolder':'2015/0619','type':0,'site_id':22,'site_name':'에버랜드','latitude':37.2939104,'longitude':127.20256640000002,'address':'한국 경기도 용인시 처인구 포곡읍 에버랜드로 199 에버랜드','approval':1,'loc_id':0},{'saved_picture':'13513896547949.jpg','savefolder':'2015/0623','type':0,'site_id':41,'site_name':'철원군','latitude':38.146609,'longitude':127.31322560000001,'address':'한국 강원도 철원군','approval':1,'loc_id':0},{'saved_picture':'13768884320242.jpg','savefolder':'2015/0623','type':0,'site_id':42,'site_name':'안동하회마을','latitude':36.5423996,'longitude':128.52797740000005,'address':'한국 경상북도 안동시 풍천면 하회리','approval':1,'loc_id':0},{'saved_picture':'20246377057487.jpg','savefolder':'2015/0624','type':0,'site_id':61,'site_name':'방통리','latitude':38.3084309,'longitude':127.5551223,'address':'한국 강원도 철원군 근동면 방통리','approval':1,'loc_id':0},{'saved_picture':'20662787351674.jpg','savefolder':'2015/0624','type':0,'site_id':62,'site_name':'인천광역시','latitude':37.4562557,'longitude':126.70520620000002,'address':'한국 인천광역시','approval':1,'loc_id':0},{'saved_picture':'21172984606232.jpg','savefolder':'2015/0624','type':0,'site_id':63,'site_name':'학원농장','latitude':35.3766925,'longitude':126.54767140000001,'address':'한국 전라북도 고창군 공음면 학원농장길','approval':1,'loc_id':0},{'saved_picture':'21378518952046.jpg','savefolder':'2015/0624','type':0,'site_id':64,'site_name':'엉또폭포','latitude':33.26854,'longitude':126.49990100000002,'address':'한국 제주특별자치도 서귀포시 강정동 엉또폭포','approval':1,'loc_id':0},{'saved_picture':'22012876100616.jpg','savefolder':'2015/0624','type':0,'site_id':65,'site_name':'북천 코스모스 메밀 축제','latitude':35.1081849,'longitude':127.8932886,'address':'한국 경상남도 하동군 북천면 곤북로 1123','approval':1,'loc_id':0},{'saved_picture':'23464417757999.jpg','savefolder':'2015/0624','type':0,'site_id':67,'site_name':'제주 사려니숲길','latitude':33.42262,'longitude':126.625616,'address':'한국 제주특별자치도 제주시 조천읍 교래리 산135','approval':1,'loc_id':0},{'saved_picture':'18264080922840.jpg','savefolder':'2015/0619','type':0,'site_id':11,'site_name':'광주광역시','latitude':35.1595454,'longitude':126.85260119999998,'address':'한국 광주광역시','approval':1,'loc_id':0},{'saved_picture':'18779494933689.jpg','savefolder':'2015/0619','type':0,'site_id':12,'site_name':'강릉시','latitude':37.751853,'longitude':128.87605740000004,'address':'한국 강원도 강릉시','approval':1,'loc_id':0},{'saved_picture':'18893890751663.jpg','savefolder':'2015/0619','type':0,'site_id':13,'site_name':'대전광역시','latitude':36.3504119,'longitude':127.38454750000005,'address':'한국 대전광역시','approval':1,'loc_id':0},{'saved_picture':'18975399904121.png','savefolder':'2015/0619','type':0,'site_id':14,'site_name':'대구광역시','latitude':35.8714354,'longitude':128.601445,'address':'한국 대구광역시','approval':1,'loc_id':0},{'saved_picture':'19132143105848.jpg','savefolder':'2015/0619','type':0,'site_id':15,'site_name':'제주도','latitude':33.4890113,'longitude':126.49830229999998,'address':'한국 제주특별자치도','approval':1,'loc_id':0},{'saved_picture':'19662609200440.jpg','savefolder':'2015/0619','type':0,'site_id':16,'site_name':'롯데월드','latitude':37.5111158,'longitude':127.09816699999999,'address':'한국 서울특별시 송파구 잠실동 올림픽로 240 롯데월드','approval':1,'loc_id':0},{'saved_picture':'20181309206171.jpeg','savefolder':'2015/0619','type':0,'site_id':17,'site_name':'인천국제공항','latitude':37.4601908,'longitude':126.44069569999999,'address':'한국 인천광역시 중구 공항로 272 인천국제공항 (ICN)','approval':1,'loc_id':0},{'saved_picture':'20471319421327.png','savefolder':'2015/0619','type':0,'site_id':18,'site_name':'원주시','latitude':37.3422186,'longitude':127.92016209999997,'address':'한국 강원도 원주시','approval':1,'loc_id':0},{'saved_picture':'20675118074930.jpg','savefolder':'2015/0619','type':0,'site_id':19,'site_name':'맨해튼','latitude':40.7830603,'longitude':-73.97124880000001,'address':'미국 뉴욕 뉴욕 맨해튼','approval':1,'loc_id':0},{'saved_picture':'20845482433625.jpg','savefolder':'2015/0619','type':0,'site_id':20,'site_name':'라스베가스','latitude':36.1699412,'longitude':-115.13982959999998,'address':'미국 네바다 라스베이거스','approval':1,'loc_id':0},{'saved_picture':'20970427506897.jpg','savefolder':'2015/0619','type':0,'site_id':21,'site_name':'시드니 오페라하우스','latitude':-33.8571965,'longitude':151.21513979999997,'address':'Sydney Opera House, 2A Macquarie Street, Sydney NSW 2000 오스트레일리아','approval':1,'loc_id':0},{'saved_picture':'1385709226184.jpg','savefolder':'2015/0625','type':0,'site_id':81,'site_name':'삼척 해양레일바이크','latitude':37.3232217,'longitude':129.266166,'address':'한국 강원도 삼척시 근덕면 공양왕길 2','approval':1,'loc_id':0}];

$(function(){
	// planMapViewAction에서 siteList의 jsonString을 받아온다
	LoadMap();
	
	
	// modalButton이 클릭됐을때 #siteAddModal 디비전에 url을 띄운다.
	$('a.modalButton').on('click', function (e) {
		e.preventDefault();
		var url = $(this).data('src');
		var target = $(this).data('target');
		$(target).removeData('bs.modal');
		$(target).modal({remote: url });
		$(target).modal('show');
	});

	// dreamcatcher로고에 마우스오버시 모달버튼이 나타난다
	// 맵에 마우스오버시 모달버튼이 사라진다
	$('#btns').hover(
  			function() {
  				$(".addSiteImgUnPushed").hide();
  				$(".addSiteImgPushed").show();
  				$(".addSiteImgText").fadeIn();
  			},
  			function() {
  				$(".addSiteImgText").fadeOut();
  				$(".addSiteImgPushed").hide();
  				$(".addSiteImgUnPushed").show();
  			}
   	);
	
	/* // 검색창 자동완성
	$("#keyword").autocomplete({
		matchContains: true,
		source : function(request, response) {

			$.ajax({
				url : "/plan?act=autoCompleteInMap",
				type : "post",
				dataType : "json",
				data: request,
					
				success: function( result ) {
			           	//return 된 녀석을 response() 함수내에 다음과 같이 정의해서 뽑아온다.
					response( 
					 	$.map( result, function( item ) {
					 			return {
					 			//label : 화면에 보여지는 텍스트
					 			//value : 실제 text태그에 들어갈 값
					 			//본인은 둘다 똑같이 줬음
					 			//화면에 보여지는 text가 즉, value가 되기때문 
					   				label: "<div style='width:100%;' onclick='markerClick(" + item.site_id + ")'>" + item.keyword + " &nbsp;  &nbsp; <span class='searchedAddress'>(" 
					   						+ item.address + ")</span></div>",
					   				value: item.keyword
					 			}
						})
					);
			           },
				error : function(data) {
					alert("에러가 발생하였습니다.")
				}
			});
		}
	});	 
	
	$.ui.autocomplete.prototype._renderItem = function (ul, item) {
        item.label = item.label.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)(" + $.ui.autocomplete.escapeRegex(this.term) + ")(?![^<>]*>)(?![^&;]+;)", "gi"), "<span class='selected-keyword'>$1</span>");
        return $("<li></li>")
                .data("item.autocomplete", item)
                .append('<a style="background-color:white">' + item.label + '</a>')
                .appendTo(ul);
        }; */	
 
    //드롭다운 버튼 클릭 시 메뉴 나타남
   	$('#dropButton').click(
   			function() { if ( $('#dropMenu').is(':visible') ) {
   							$('#dropMenu').slideUp();
   						 } else {
   							$('#dropMenu').slideDown(); 
   	}});
   	
   	
   	//검색창에 마우스오버 시 투명도 1
   	$('#searchWindow, .ui-autocomplete').hover(
  			function() {
  				$('#searchWindow, .ui-autocomplete').css({'-webkit-transition':'all 0.5s ease','opacity': '1'})
  			},
  			function() {
  				$('#searchWindow, .ui-autocomplete').css({'-webkit-transition':'all 0.5s ease','opacity': '0.3'})
  			}
   	);
   	
   	


});



//일정관리 버튼 눌렀을 때 추가한 루트가 0개라면 submit 막음.
function isPolylistCheck() {
	if(polylist) {
		 mapSave();
	} else {
		alert("지도에서 경로를 추가하세요.");
		return false;
	}
}

//일정등록 버튼 눌렀을때, 지도 끝
function mapSave() {

	makeRouteImageURL(); //루트의 위도 경로로 google static map 이미지를 가져올 URL을 만든다.

	var jsonObject = {"polylist":polylist, "route_url":route_url};
								//	console.log(jsonObject);	//	alert(jsonObject.route_url);		//	alert(jsonObject.polylist[0].site_name);		//	console.log(jsonObject);
	var jsonString = JSON.stringify(jsonObject);
								//	alert(jsonString);
	$("#act").val("moveToPlanPage");
	$("#jsonString").val(jsonString);
	document.plannerForm.action = root + "/plan";
	document.plannerForm.submit();
}


function moveSiteView(site_id){
	document.location.href = '/site?act=siteView&site_id='+site_id;
}

function logout(){
	jQuery.ajax({
		url: '/member',
		type : 'post',
		data : {'act':'logout'},
		dataType : 'json',
		success : memberLogoutSuccess,
		error : function(){alert('오류가 발생했습니다.\n나중에 다시 시도해주세요.');}
	});
}

function memberLogoutSuccess(data){
	var result = data.result;
	if(result == 'logoutSuccess'){
		document.location.href = "/";
	}
}

</script>



</head>
<!-- <body oncontextmenu="return false" ondragstart="return false" onselectstart="return false"> <!-- 우클릭&드래그 막기 프로젝트완성후 주석풀기 -->
<body>
	<!-- 모달창 -->
	<div class="modal fade" id="siteAddModal" tabindex="-1" role="dialog" aria-labelledby="siteAddModalLabel" aria-hidden="true">
		<div class="modal-content">
		</div>
	</div>
	
	<div class="mapHeader">
		<a href="/dreamcatcher/"><div class="mapLogo"></div></a>
					
		<div id="dropButton"></div>
		
		<div id="dropMenu" style="display:none;">
			<div class="dropMenuItem" onclick="javascript:history.back();">돌아가기</div>			
			<a href="/dreamcatcher/plan?act=registerMap">
				<div class="dropMenuItem">새로 만들기</div></a>
			<hr class="dropMenuLine">
			<a href="/dreamcatcher/site?act=siteArticleList&page=1">
				<div class="dropMenuItem">메인</div></a>
			<a href="/dreamcatcher/">
				<div class="dropMenuItem">여행지정보</div></a>
			<a href="/dreamcatcher/route?act=routeArticleList&page=1">
				<div class="dropMenuItem">추천경로</div></a>
			<a href="/dreamcatcher/myInfo.tiles">
				<div class="dropMenuItem">마이페이지</div></a>
			<hr class="dropMenuLine">
			<div class="dropMenuItem" onclick="javascript:logout();">로그아웃</div>
		</div>
	</div>
	
 	
	<div id="base">
		
		<!-- 모달띄우는 버튼 --><div id="btns">
		<img src="assets/imgs/planner/addsiteimgUnPushed.png" class="addSiteImgUnPushed">
			<a class="modalButton" data-src="siteMake.html" data-target="#siteAddModal">
		<img src="assets/imgs/planner/addsiteimgPushed.png" class="addSiteImgPushed" style="display:none;">
		<img src="assets/imgs/planner/addsiteimgText.png" class="addSiteImgText" style="display:none;">
		</a></div>
	
		
		<form id="siteSearchForm" method="get" action="" onsubmit="return false;">
			<input type="hidden" id="searchWord" name="searchWord" value="">
			<!-- 검색창 -->
			<div class="searchWindow" id="searchWindow">
				<!-- 검색텍스트 -->
				<div class="searchImg"><img src="assets/imgs/planner/search_icon.png"></div>
				<!-- 검색텍스트필드 -->
				<input class="searchTextField" id="keyword" name="keyword" placeholder="찾으시는 지역을 검색해보세요" value="">
			</div>
		</form>
		
		
		<!-- 지도 -->
		<div id="map_canvas"></div>
		
		
		<!-- 루트영역 -->
		<div id="stopArea"></div>
		
	
		<!-- 지도 끝 버튼 -->
 		<form name="plannerForm" id="plannerForm" method="post" action="" onsubmit="return false;">
			<input type="hidden" id="act" name="act" value="" />
			<input type="hidden" id="jsonString" name="jsonString" value="" />
			<div class="mapSaveBtn" onclick="javascript:isPolylistCheck();"><span class="mapSaveText">일정등록</span></div>
		</form>
				
	</div>
</body>
</html>
